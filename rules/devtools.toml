# Developer Tools Permission Gate
#
# Handles developer tools that can modify files:
# - sd: Stream editor (always asks)
# - sad: Search and replace with preview
# - ast-grep: AST-based code search/rewrite
# - yq: YAML processor
# - jq: JSON processor (always safe)
# - semgrep: Code analysis with optional autofix
# - comby: Structural search/replace
# - grit: Code migrations
# - watchexec: File watcher
# - biome: JavaScript linter/formatter
# - prettier: Code formatter
# - eslint: JavaScript linter
# - ruff: Python linter/formatter
# - black: Python formatter
# - isort: Python import sorter
#
# Pattern: Most tools are safe in read mode, risky with write flags

[meta]
name = "devtools"
description = "Developer tools permission gate"
priority = 25

# =============================================================================
# SD (always asks - in-place editor)
# =============================================================================

[[programs]]
name = "sd"
unknown_action = "ask"

# sd is always a write operation
[[programs.ask]]
reason = "In-place text replacement"
accept_edits_auto_allow = true

# =============================================================================
# SAD (preview mode safe, --commit asks)
# =============================================================================

[[programs]]
name = "sad"
unknown_action = "allow"  # Default is preview mode

[[programs.ask]]
reason = "Applying replacements"
if_flags_any = ["--commit"]
accept_edits_auto_allow = true

# =============================================================================
# AST-GREP (search safe, -U/--update-all asks)
# =============================================================================

[[programs]]
name = "ast-grep"
aliases = ["sg"]
unknown_action = "allow"  # Default is search mode

[[programs.ask]]
reason = "Rewriting code"
if_flags_any = ["-U", "--update-all"]
accept_edits_auto_allow = true

# =============================================================================
# YQ (read safe, -i/--inplace asks)
# =============================================================================

[[programs]]
name = "yq"
unknown_action = "allow"  # Default is read mode

[[programs.ask]]
reason = "In-place YAML edit"
if_flags_any = ["-i", "--inplace"]
accept_edits_auto_allow = true

# =============================================================================
# JQ (always safe - read-only)
# =============================================================================

[[programs]]
name = "jq"
unknown_action = "allow"

# =============================================================================
# SEMGREP (scan safe, --autofix/--fix asks)
# =============================================================================

[[programs]]
name = "semgrep"
unknown_action = "allow"  # Default is scan mode

[[programs.ask]]
reason = "Auto-fixing code"
if_flags_any = ["--autofix", "--fix"]
accept_edits_auto_allow = true

# =============================================================================
# COMBY (match safe, -in-place/-i asks)
# =============================================================================

[[programs]]
name = "comby"
unknown_action = "allow"  # Default is match mode

[[programs.ask]]
reason = "In-place replacement"
if_flags_any = ["-in-place", "-i"]
accept_edits_auto_allow = true

# =============================================================================
# GRIT (check safe, apply asks)
# =============================================================================

[[programs]]
name = "grit"
unknown_action = "allow"

[[programs.ask]]
subcommand = "apply"
reason = "Applying migrations"
accept_edits_auto_allow = true

# =============================================================================
# WATCHEXEC (always asks - runs commands)
# =============================================================================

[[programs]]
name = "watchexec"
unknown_action = "ask"

[[programs.ask]]
reason = "Runs commands on file changes"

# =============================================================================
# BIOME (check safe, --write asks)
# =============================================================================

[[programs]]
name = "biome"
unknown_action = "allow"

# check --write/--fix/--fix-unsafe asks
[[programs.ask]]
subcommand = "check"
reason = "Writing fixes"
if_flags_any = ["--write", "--fix", "--fix-unsafe"]
accept_edits_auto_allow = true

# format --write asks
[[programs.ask]]
subcommand = "format"
reason = "Formatting files"
if_flags_any = ["--write"]
accept_edits_auto_allow = true

# lint is read-only
[[programs.allow]]
subcommand = "lint"

# =============================================================================
# PRETTIER (check safe, --write/-w asks)
# =============================================================================

[[programs]]
name = "prettier"
unknown_action = "allow"

[[programs.ask]]
reason = "Writing formatted files"
if_flags_any = ["--write", "-w"]
accept_edits_auto_allow = true

# =============================================================================
# ESLINT (lint safe, --fix asks)
# =============================================================================

[[programs]]
name = "eslint"
unknown_action = "allow"

[[programs.ask]]
reason = "Auto-fixing"
if_flags_any = ["--fix"]
accept_edits_auto_allow = true

# =============================================================================
# RUFF (check safe, check --fix asks, format without --check asks)
# =============================================================================

[[programs]]
name = "ruff"
unknown_action = "allow"

# check --fix asks
[[programs.ask]]
subcommand = "check"
reason = "Auto-fixing"
if_flags_any = ["--fix"]
accept_edits_auto_allow = true

# format --check/--diff is read-only
[[programs.allow]]
subcommand = "format"
if_flags_any = ["--check", "--diff"]

# format without --check/--diff asks (writes files)
[[programs.ask]]
subcommand = "format"
reason = "Formatting files"
accept_edits_auto_allow = true

# =============================================================================
# BLACK (--check/--diff safe, otherwise asks)
# =============================================================================

[[programs]]
name = "black"
unknown_action = "ask"

# --check and --diff are safe (read-only verification)
[[programs.allow]]
if_flags_any = ["--check", "--diff"]

[[programs.ask]]
reason = "Formatting files"
accept_edits_auto_allow = true

# =============================================================================
# ISORT (--check/--check-only/--diff safe, otherwise asks)
# =============================================================================

[[programs]]
name = "isort"
unknown_action = "ask"

# --check, --check-only, and --diff are safe (read-only verification)
[[programs.allow]]
if_flags_any = ["--check", "--check-only", "--diff"]

[[programs.ask]]
reason = "Sorting imports"
accept_edits_auto_allow = true

# =============================================================================
# SHELLCHECK (always safe - read-only static analysis)
# =============================================================================

[[programs]]
name = "shellcheck"
unknown_action = "allow"

[[programs]]
name = "hadolint"
unknown_action = "allow"

# =============================================================================
# GOLANGCI-LINT (--fix modifies files, otherwise read-only)
# =============================================================================

[[programs]]
name = "golangci-lint"
unknown_action = "allow"

[[programs.ask]]
reason = "Applying lint fixes"
if_flags_any = ["--fix"]
accept_edits_auto_allow = true

# =============================================================================
# GCI (Go import organizer - write subcommand modifies files)
# =============================================================================

[[programs]]
name = "gci"
unknown_action = "allow"

[[programs.ask]]
reason = "Formatting imports"
if_flags_any = ["write"]
accept_edits_auto_allow = true

# =============================================================================
# AIR (Go hot-reload - runs/watches files)
# =============================================================================

[[programs]]
name = "air"
unknown_action = "allow"  # Just runs go build/run in watch mode

# =============================================================================
# ACTIONLINT (GitHub Actions linter - read-only)
# =============================================================================

[[programs]]
name = "actionlint"
unknown_action = "allow"

# =============================================================================
# VITE (dev server / build tool)
# =============================================================================

[[programs]]
name = "vite"
unknown_action = "allow"

# =============================================================================
# VITEST (test runner)
# =============================================================================

[[programs]]
name = "vitest"
unknown_action = "allow"

# =============================================================================
# JEST (test runner)
# =============================================================================

[[programs]]
name = "jest"
unknown_action = "allow"

# =============================================================================
# MOCHA (test runner)
# =============================================================================

[[programs]]
name = "mocha"
unknown_action = "allow"

# =============================================================================
# TSC (TypeScript compiler - type checking)
# =============================================================================

[[programs]]
name = "tsc"
unknown_action = "allow"

# =============================================================================
# TSUP (TypeScript bundler)
# =============================================================================

[[programs]]
name = "tsup"
unknown_action = "allow"

# =============================================================================
# ESBUILD (JavaScript bundler)
# =============================================================================

[[programs]]
name = "esbuild"
unknown_action = "allow"

# =============================================================================
# TURBO (monorepo build tool)
# =============================================================================

[[programs]]
name = "turbo"
unknown_action = "allow"

# =============================================================================
# NX (monorepo build tool)
# =============================================================================

[[programs]]
name = "nx"
unknown_action = "allow"

# =============================================================================
# KNIP (dead code detector)
# =============================================================================

[[programs]]
name = "knip"
unknown_action = "allow"

# =============================================================================
# OXLINT (fast linter)
# =============================================================================

[[programs]]
name = "oxlint"
unknown_action = "allow"

# =============================================================================
# GOFMT (Go formatter)
# =============================================================================

[[programs]]
name = "gofmt"
unknown_action = "allow"

# -w writes files, needs approval
[[programs.ask]]
reason = "Formatting files"
if_flags_any = ["-w"]
accept_edits_auto_allow = true

# =============================================================================
# GOIMPORTS (Go import formatter - -w writes files)
# =============================================================================

[[programs]]
name = "goimports"
unknown_action = "allow"

[[programs.ask]]
reason = "Formatting imports"
if_flags_any = ["-w"]
accept_edits_auto_allow = true

# =============================================================================
# SHFMT (Shell formatter - -w writes files)
# =============================================================================

[[programs]]
name = "shfmt"
unknown_action = "allow"

[[programs.ask]]
reason = "Formatting files"
if_flags_any = ["-w"]
accept_edits_auto_allow = true

# =============================================================================
# RUSTFMT (Rust formatter - --check is read-only, otherwise writes)
# =============================================================================

[[programs]]
name = "rustfmt"
unknown_action = "ask"

[[programs.allow]]
if_flags_any = ["--check"]

[[programs.ask]]
reason = "Formatting files"
accept_edits_auto_allow = true

# =============================================================================
# STYLUA (Lua formatter - --check is read-only, otherwise writes)
# =============================================================================

[[programs]]
name = "stylua"
unknown_action = "ask"

[[programs.allow]]
if_flags_any = ["--check"]

[[programs.ask]]
reason = "Formatting files"
accept_edits_auto_allow = true

# =============================================================================
# CLANG-FORMAT (C/C++ formatter - -i writes files, otherwise stdout)
# =============================================================================

[[programs]]
name = "clang-format"
unknown_action = "allow"

[[programs.ask]]
reason = "Formatting files in-place"
if_flags_any = ["-i"]
accept_edits_auto_allow = true

# =============================================================================
# AUTOPEP8 (Python formatter - -i/--in-place writes files, otherwise stdout)
# =============================================================================

[[programs]]
name = "autopep8"
unknown_action = "allow"

[[programs.ask]]
reason = "Formatting files in-place"
if_flags_any = ["-i", "--in-place"]
accept_edits_auto_allow = true

# =============================================================================
# RUBOCOP (Ruby linter - -a/-A/--auto-correct modifies files)
# =============================================================================

[[programs]]
name = "rubocop"
unknown_action = "allow"

[[programs.ask]]
reason = "Auto-correcting"
if_flags_any = ["-a", "-A", "--auto-correct", "--autocorrect"]
accept_edits_auto_allow = true

# =============================================================================
# STANDARDRB (Ruby linter - -a/-A/--auto-correct modifies files)
# =============================================================================

[[programs]]
name = "standardrb"
unknown_action = "allow"

[[programs.ask]]
reason = "Auto-correcting"
if_flags_any = ["-a", "-A", "--auto-correct", "--autocorrect"]
accept_edits_auto_allow = true

# =============================================================================
# PATCH (applies diff patches - --dry-run is read-only)
# =============================================================================

[[programs]]
name = "patch"
unknown_action = "ask"

[[programs.allow]]
if_flags_any = ["--dry-run"]

[[programs.ask]]
reason = "Applying patch"
accept_edits_auto_allow = true

# =============================================================================
# DOS2UNIX / UNIX2DOS (line ending converters - always modify files)
# =============================================================================

[[programs]]
name = "dos2unix"
unknown_action = "ask"

[[programs.ask]]
reason = "Converting line endings"
accept_edits_auto_allow = true

[[programs]]
name = "unix2dos"
unknown_action = "ask"

[[programs.ask]]
reason = "Converting line endings"
accept_edits_auto_allow = true

# =============================================================================
# STYLELINT (CSS/SCSS linter - --fix modifies files)
# =============================================================================

[[programs]]
name = "stylelint"
unknown_action = "allow"

[[programs.ask]]
reason = "Auto-fixing styles"
if_flags_any = ["--fix"]
accept_edits_auto_allow = true

# =============================================================================
# MIX (Elixir build tool - mix format always modifies files)
# =============================================================================

[[programs]]
name = "mix"
unknown_action = "allow"

[[programs.ask]]
subcommand = "format"
reason = "Formatting files"
accept_edits_auto_allow = true

# =============================================================================
# PERLTIDY (Perl formatter - -b flag writes back to original file)
# =============================================================================

[[programs]]
name = "perltidy"
unknown_action = "allow"

[[programs.ask]]
reason = "Formatting in-place"
if_flags_any = ["-b"]
accept_edits_auto_allow = true

# =============================================================================
# DARTFMT (Dart formatter - writes by default)
# =============================================================================

[[programs]]
name = "dartfmt"
unknown_action = "ask"

[[programs.ask]]
reason = "Formatting files"
accept_edits_auto_allow = true

# =============================================================================
# DART (dart format command - writes by default, --output=show is read-only)
# =============================================================================

[[programs]]
name = "dart"
unknown_action = "allow"

[[programs.ask]]
subcommand = "format"
reason = "Formatting files"
accept_edits_auto_allow = true

# =============================================================================
# ELM-FORMAT (Elm formatter - writes by default)
# =============================================================================

[[programs]]
name = "elm-format"
unknown_action = "ask"

[[programs.ask]]
reason = "Formatting files"
accept_edits_auto_allow = true

# =============================================================================
# SCALAFMT (Scala formatter - writes by default, --check is read-only)
# =============================================================================

[[programs]]
name = "scalafmt"
unknown_action = "ask"

[[programs.allow]]
if_flags_any = ["--check"]

[[programs.ask]]
reason = "Formatting files"
accept_edits_auto_allow = true

# =============================================================================
# KTLINT (Kotlin linter - -F/--format modifies files)
# =============================================================================

[[programs]]
name = "ktlint"
unknown_action = "allow"

[[programs.ask]]
reason = "Formatting files"
if_flags_any = ["-F", "--format"]
accept_edits_auto_allow = true

# =============================================================================
# SWIFTFORMAT (Swift formatter - writes by default, --lint is read-only)
# =============================================================================

[[programs]]
name = "swiftformat"
unknown_action = "ask"

[[programs.allow]]
if_flags_any = ["--lint"]

[[programs.ask]]
reason = "Formatting files"
accept_edits_auto_allow = true

# =============================================================================
# BUF (Protocol Buffers tool - buf format writes by default, --diff is read-only)
# =============================================================================

[[programs]]
name = "buf"
unknown_action = "allow"

[[programs.ask]]
subcommand = "format"
reason = "Formatting files"
accept_edits_auto_allow = true
